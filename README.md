# alice-cloud-proxy

Готовая [облачная функция](https://cloud.yandex.ru/docs/functions/concepts/function) для быстрого развертывания своего прокси-навыка на Я.Облаке.

## Применения

1. **Как входная точка перед основным вебхуком навыка**
    - при ошибках вебхука функция возвращает корректный ответ (не происходит выхода из навыка)
    - если вебхук не ответил за указанный таймаут, функция также вернет корректный ответ (текст можно настраивать) 
    - функция сама отвечает на пинг-запросы, и до вашего кода они не доходят (не сжигают ваш траффик)

2. **Как навык для тестирования других навыков без публикации**
   - Сделав приватный навык с такой облачной функцией, можно прямо из него проксировать запросы на другие ваши навыки в разработке.
     Это позволяет тестировать их прямо на устройствах с Алисой без публикации.

## Настройка

1. Создайте облачную функцию согласно [инструкции](https://yandex.ru/dev/dialogs/alice/doc/deploy-ycloud-function-docpage/) для Node.js
2. Создайте в редакторе функции файл `index.js` и скопируйте туда код из [src/index.js](https://github.com/vitalets/alice-cloud-proxy/blob/master/src/index.js)
3. Создайте в редакторе функции файл конфигурации `config.js` и скопируйте туда код из [src/config.js](https://github.com/vitalets/alice-cloud-proxy/blob/master/src/config.js).
   Измените необходимые параметры под себя
4. Укажите точку входа функции: `index.handler`
5. Сохраните изменения в функции, нажав на кнопку "Создать версию"
6. [В панели разработчика](https://yandex.ru/dev/dialogs/alice/doc/publish-docpage/#publish) заведите тестовый приватный навык, который будете использовать как прокси для других навыков
7. В настройках прокси-навыка укажите вашу функцию:
   <img src="https://user-images.githubusercontent.com/1473072/66268276-79c6c280-e844-11e9-83c5-15fe37c32583.png" width="600"> 
8. Сохраните изменения, перейдите на вкладку тестирование и проверьте, что проксирующий навык работает (должен отвечать *Please set targetUrl in config.js*):
   <img src="https://user-images.githubusercontent.com/1473072/66268399-b47d2a80-e845-11e9-97d3-11be682d94f6.png" width="600">

## Использование

1. Запустите локальную версию тестируемого навыка (например на 3000 порту)
2. Запустите [ngrok](https://ngrok.com/), чтобы сделать порт доступным извне:
   ```bash
   ngrok http -region=eu 3000
   ```
3. Скопируйте урл из вывода ngrok:

   <img src="https://user-images.githubusercontent.com/1473072/66268339-125d4280-e845-11e9-901c-488a41305ba7.png" width="600"><br>
   
   и вставьте в `config.js`:
   ```js
   module.exports = {
     targetUrl: 'http://5d7df68d.eu.ngrok.io',
     // ...
   };
   ```
4. Сохраните изменения в функции (кнопка "Создать версию")
5. Запустите проксирующий навык в приложении с Алисой - запросы пойдут на ваш локальный навык

## Лицензия
MIT @ [Vitaliy Potapov](https://github.com/vitalets)
